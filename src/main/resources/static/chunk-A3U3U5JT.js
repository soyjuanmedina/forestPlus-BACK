import{a as O}from"./chunk-5BUBBXBX.js";import{a as G}from"./chunk-LF5WZ7KE.js";import{b as N}from"./chunk-P4UYLIGP.js";import{$ as v,Ba as n,Da as h,E as x,J as f,Ja as w,Jb as I,K as b,Mb as V,Nb as A,Ob as a,Pb as M,Qb as B,Sb as j,T,Tb as D,U as c,Ub as z,V as p,Va as E,Vb as R,Za as S,Zb as q,_b as H,ac as Y,ca as g,eb as _,gb as F,ha as i,ia as t,ja as d,lb as k,na as C,qa as y,sa as u}from"./chunk-N25POV3O.js";function U(l,L){if(l&1){let r=C();i(0,"div",1)(1,"form",2),y("ngSubmit",function(){f(r);let o=u();return b(o.onSubmitTreeType())}),i(2,"h1",3),n(3),t(),i(4,"div",4),d(5,"img",5),i(6,"label",6)(7,"span",7),n(8,"photo_camera"),t(),i(9,"span"),n(10,"Seleccionar imagen"),t(),i(11,"input",8),y("change",function(o){f(r);let s=u();return b(s.onTreeTypeFileSelected(o))}),t()()(),i(12,"div",9)(13,"div",10)(14,"label",11),n(15,"Nombre"),t(),d(16,"input",12),t(),i(17,"div",10)(18,"label",13),n(19,"Descripci\xF3n"),t(),d(20,"input",14),t()(),i(21,"div",9)(22,"div",10)(23,"label",15),n(24,"Absorci\xF3n de CO\u2082 (kg/a\xF1o)"),t(),d(25,"input",16),t(),i(26,"div",10)(27,"label",17),n(28,"Altura t\xEDpica (m)"),t(),d(29,"input",18),t(),i(30,"div",10)(31,"label",19),n(32,"A\xF1os de vida"),t(),d(33,"input",20),t()(),i(34,"div",21)(35,"button",22),y("click",function(){f(r);let o=u();return b(o.cancel())}),n(36," Cancelar "),t(),i(37,"button",23),n(38),t()()()()}if(l&2){let r=u();c(),g("formGroup",r.treeTypeForm),c(2),h(" ",r.treeType.id?"Editar Tipo de \xC1rbol":"Nuevo Tipo de \xC1rbol"," "),c(2),g("src",r.previewImage||r.treeType.picture||"assets/tree-placeholder.png",T),c(33),h(" ",r.treeType.id?"Guardar cambios":"Crear tipo de \xE1rbol"," ")}}var oe=(()=>{class l{constructor(r,e,o,s,m){this.fb=r,this.treeTypeService=e,this.route=o,this.router=s,this.snackBar=m,this.previewImage=null}ngOnInit(){this.initForm();let r=this.route.snapshot.paramMap.get("id");r?this.loadTreeType(+r):this.treeType={}}initForm(){this.treeTypeForm=this.fb.group({name:["",a.required],description:[""],co2Absorption:[0,[a.required,a.min(0)]],typicalHeight:[0,[a.required,a.min(0)]],lifespanYears:[0,[a.required,a.min(1)]]})}loadTreeType(r){this.treeTypeService.getTreeTypeById(r).subscribe({next:e=>{this.treeType=e,this.treeTypeForm.patchValue({name:e.name,description:e.description,co2Absorption:e.co2Absorption,typicalHeight:e.typicalHeight,lifespanYears:e.lifespanYears})},error:e=>{console.error("Error al cargar el tipo de \xE1rbol",e),this.snackBar.open("\u274C Error al cargar el tipo de \xE1rbol","Cerrar",{duration:3e3})}})}onTreeTypeFileSelected(r){let e=r.target;if(!e.files?.length)return;let o=e.files[0],s=new FileReader;s.onload=()=>this.previewImage=s.result,s.readAsDataURL(o),this.treeType?.id&&this.treeTypeService.updateTreeTypePicture(this.treeType.id,o).subscribe({next:m=>{this.treeType=m,this.snackBar.open("\u2705 Imagen actualizada","Cerrar",{duration:3e3})},error:m=>{console.error("Error al actualizar la imagen",m),this.snackBar.open("\u274C Error al actualizar la imagen","Cerrar",{duration:3e3})}})}onSubmitTreeType(){if(this.treeTypeForm.invalid)return;let r=this.treeTypeForm.value;console.log("formValue",r),this.treeType?.id?this.treeTypeService.updateTreeType(this.treeType.id,r).subscribe({next:()=>{this.snackBar.open("\u2705 Tipo de \xE1rbol actualizado","Cerrar",{duration:3e3}),this.router.navigate(["/admin/tree-types"])},error:e=>{console.error("Error al actualizar el tipo de \xE1rbol",e),this.snackBar.open("\u274C Error al actualizar el tipo de \xE1rbol","Cerrar",{duration:3e3})}}):this.treeTypeService.createTreeType(r).subscribe({next:()=>{this.snackBar.open("\u2705 Tipo de \xE1rbol creado","Cerrar",{duration:3e3}),this.router.navigate(["/admin/tree-types"])},error:e=>{console.error("Error al crear el tipo de \xE1rbol",e),this.snackBar.open("\u274C Error al crear el tipo de \xE1rbol","Cerrar",{duration:3e3})}})}cancel(){this.router.navigate(["/admin/tree-types"])}static{this.\u0275fac=function(e){return new(e||l)(p(H),p(O),p(_),p(F),p(G))}}static{this.\u0275cmp=x({type:l,selectors:[["app-tree-types-form"]],standalone:!0,features:[w],decls:1,vars:1,consts:[["class","w-full max-w-full mx-auto bg-white p-6 rounded-2xl shadow-lg",4,"ngIf"],[1,"w-full","max-w-full","mx-auto","bg-white","p-6","rounded-2xl","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"text-2xl","font-bold","mb-6","text-center"],[1,"md:col-span-2","flex","flex-col","items-center","mb-6"],["alt","Imagen del \xE1rbol",1,"w-24","h-24","rounded-full","shadow-lg","mb-2","object-cover",3,"src"],[1,"cursor-pointer","bg-gray-200","hover:bg-gray-300","p-2","rounded-full","flex","items-center","gap-2"],[1,"material-icons"],["type","file","accept","image/*","hidden","",3,"change"],[1,"flex","flex-col","md:flex-row","gap-4","mb-6"],[1,"flex-1"],["for","name",1,"block","text-gray-700","font-medium","mb-1"],["id","name","type","text","formControlName","name","required","","placeholder","Nombre del tipo de \xE1rbol",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition"],["for","description",1,"block","text-gray-700","font-medium","mb-1"],["id","description","type","text","formControlName","description","placeholder","Descripci\xF3n del tipo de \xE1rbol",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition"],["for","co2Absorption",1,"block","text-gray-700","font-medium","mb-1"],["id","co2Absorption","type","number","formControlName","co2Absorption","step","0.01","placeholder","Ej. 12.5",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition"],["for","typicalHeight",1,"block","text-gray-700","font-medium","mb-1"],["id","typicalHeight","type","number","formControlName","typicalHeight","step","0.01","placeholder","Ej. 10.0",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition"],["for","lifespanYears",1,"block","text-gray-700","font-medium","mb-1"],["id","lifespanYears","type","number","formControlName","lifespanYears","placeholder","Ej. 50",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition"],[1,"flex","justify-end","gap-4","mt-6"],["type","button",1,"flex-1","bg-gray-300","text-gray-700","py-3","rounded-xl","hover:bg-gray-400","transition",3,"click"],["type","submit",1,"flex-1","bg-green-600","text-white","py-3","rounded-xl","hover:bg-green-700","disabled:opacity-50","transition"]],template:function(e,o){e&1&&v(0,U,39,4,"div",0),e&2&&g("ngIf",o.treeType)},dependencies:[S,E,Y,j,A,D,M,B,q,z,R,N,V,I,k]})}}return l})();export{oe as TreeTypesFormComponent};
