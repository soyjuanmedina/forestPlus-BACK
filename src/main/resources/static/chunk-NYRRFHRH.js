import{b as $,c as P}from"./chunk-X4JOGK6C.js";import{d as ae}from"./chunk-476J6XEL.js";import{a as O,b as R,h as oe}from"./chunk-IC3WLJWW.js";import{a as N}from"./chunk-PQEWOXHD.js";import{b as q,c as z}from"./chunk-NFADQOFW.js";import{b as U}from"./chunk-ODURNTPO.js";import{a as H,b as j,d as J,e as K,h as Q,j as W,k as X,l as Y,m as Z,n as ee,o as te,r as ie,s as ne,t as re}from"./chunk-W5EN7SUI.js";import{Ab as G,Ba as o,Bb as V,Ca as a,Da as S,Db as E,Ha as F,Ka as f,M as I,Ma as _,Nb as L,S as h,T as y,Vb as A,Wa as B,Wb as w,Xa as l,Ya as T,Za as v,_a as k,ea as r,eb as b,fa as m,ib as d,jb as p,lb as D,ra as g,va as s,xb as M,yb as C}from"./chunk-QVELB6IZ.js";function me(t,u){if(t&1&&(o(0,"option",12),l(1),a()),t&2){let e=u.$implicit;s("value",e.id),r(),T(e.name)}}function ue(t,u){if(t&1&&(o(0,"li",14),S(1,"input",15),l(2),d(3,"date"),a()),t&2){let e=u.$implicit;r(),s("value",e.id),r(),k(" ",e.treeTypeName," - Plantado: ",p(3,3,e.plantedAt)," ")}}function ge(t,u){if(t&1&&(o(0,"div")(1,"label",4),l(2),d(3,"translate"),a(),o(4,"ul"),g(5,ue,4,5,"li",13),a()()),t&2){let e=_();r(2),T(p(3,2,"ASSIGN_TREES.TREES")),r(3),s("ngForOf",e.unassignedTrees)}}function fe(t,u){t&1&&(o(0,"p",16),l(1),d(2,"translate"),a()),t&2&&(r(),v(" ",p(2,1,"ASSIGN_TREES.NO_TREES")," "))}var Ae=(()=>{class t{constructor(e,n,i,c,x){this.fb=e,this.landService=n,this.treeService=i,this.dialogRef=c,this.data=x,this.lands=[],this.unassignedTrees=[],this.form=this.fb.group({landId:[null,j.required],treeId:[null,j.required]})}ngOnInit(){this.landService.getAllLands().subscribe(e=>this.lands=e)}onLandChange(e){let n=Number(e.target.value);this.treeService.getUnassignedTreesByLand(n).subscribe(i=>this.unassignedTrees=i)}submit(){if(!this.form.valid)return;let e=this.form.value.treeId,n=this.data.userId?{userId:this.data.userId,treeId:e}:{companyId:this.data.companyId,treeId:e};this.dialogRef.close(n)}static{this.\u0275fac=function(n){return new(n||t)(m(ie),m(ae),m(N),m(O),m(R))}}static{this.\u0275cmp=I({type:t,selectors:[["app-assign-trees-modal"]],standalone:!0,features:[b],decls:20,vars:17,consts:[[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[3,"ngSubmit","formGroup"],[1,"mb-6"],[1,"block","text-gray-700","mb-1"],["formControlName","landId",1,"w-full","rounded-xl","border","border-gray-300","p-2",3,"change"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["class","text-gray-500 italic",4,"ngIf"],[1,"flex","justify-end","gap-4","mt-8"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50","transition",3,"disabled"],[3,"value"],["class","flex items-center gap-2 py-1",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2","py-1"],["type","radio","formControlName","treeId",3,"value"],[1,"text-gray-500","italic"]],template:function(n,i){n&1&&(o(0,"div",0)(1,"h2",1),l(2),d(3,"translate"),a(),o(4,"form",2),f("ngSubmit",function(){return i.submit()}),o(5,"div",3)(6,"label",4),l(7),d(8,"translate"),a(),o(9,"select",5),f("change",function(x){return i.onLandChange(x)}),g(10,me,2,2,"option",6),a()(),g(11,ge,6,4,"div",7)(12,fe,3,3,"p",8),o(13,"div",9)(14,"button",10),f("click",function(){return i.dialogRef.close()}),l(15),d(16,"translate"),a(),o(17,"button",11),l(18),d(19,"translate"),a()()()()),n&2&&(r(2),v(" ",p(3,9,"ASSIGN_TREES.TITLE")," "),r(2),s("formGroup",i.form),r(3),T(p(8,11,"ASSIGN_TREES.LAND")),r(3),s("ngForOf",i.lands),r(),s("ngIf",i.unassignedTrees==null?null:i.unassignedTrees.length),r(),s("ngIf",!(i.unassignedTrees!=null&&i.unassignedTrees.length)),r(3),v(" ",p(16,13,"COMMON.CANCEL")," "),r(2),s("disabled",i.form.invalid),r(),v(" ",p(19,15,"ASSIGN_TREES.ASSIGN")," "))},dependencies:[E,M,C,V,oe,U,ne,Q,ee,te,H,Z,W,J,K,re,X,Y,w,A],encapsulation:2})}}return t})();function _e(t,u){t&1&&S(0,"app-loading-spinner")}function ve(t,u){if(t&1){let e=F();o(0,"li",9)(1,"div")(2,"span",10),l(3),a(),S(4,"br"),o(5,"span",11),l(6),a()(),o(7,"div",12)(8,"button",13),f("click",function(){let i=h(e).$implicit,c=_(3);return y(c.viewTree(i.id))}),o(9,"mat-icon",14),l(10,"visibility"),a()(),o(11,"button",13),f("click",function(){let i=h(e).$implicit,c=_(3);return y(c.editTree(i.id))}),o(12,"mat-icon",15),l(13,"edit"),a()(),o(14,"button",16),f("click",function(){let i=h(e).$implicit,c=_(3);return y(c.unassignTree(i.id))}),o(15,"mat-icon",15),l(16,"delete"),a()()()()}if(t&2){let e=u.$implicit;r(3),v("Terreno: ",e.landName,""),r(3),T(e.treeTypeName)}}function Te(t,u){if(t&1&&(o(0,"ul"),g(1,ve,17,2,"li",8),a()),t&2){let e=_(2);r(),s("ngForOf",e.trees)}}function xe(t,u){t&1&&(o(0,"p",17),l(1),d(2,"translate"),a()),t&2&&(r(),T(p(2,1,"ASSIGN_TREES.NO_TREES_TO_MANAGE")))}function he(t,u){if(t&1){let e=F();o(0,"div",3)(1,"h2",4),l(2),d(3,"translate"),a(),g(4,Te,2,1,"ul",5)(5,xe,3,3,"ng-template",null,0,D),o(7,"div",6)(8,"button",7),f("click",function(){h(e);let i=_();return y(i.close())}),l(9),d(10,"translate"),a()()()}if(t&2){let e=B(6),n=_();r(2),v(" ",p(3,4,"MANAGE_TREES.TITLE")," "),r(2),s("ngIf",n.trees==null?null:n.trees.length)("ngIfElse",e),r(5),v(" ",p(10,6,"COMMON.CLOSE")," ")}}var Ge=(()=>{class t{constructor(e,n,i,c,x){this.data=e,this.dialogRef=n,this.treeService=i,this.router=c,this.loadingService=x,this.treeTypeName="",this.trees=[],this.target="company",this.treeTypeName=e.treeTypeName||"",this.target=e.target||"company",this.companyId=e.companyId,this.treeTypeId=e.treeTypeId}ngOnInit(){if(this.loadingService.show(),this.data.userId&&this.treeTypeId!==void 0){this.target="user",this.treeService.getTreesByOwnerAndType(this.treeTypeId,this.data.userId,void 0).subscribe({next:e=>this.trees=e,error:e=>console.error("Error cargando \xE1rboles del usuario",e),complete:()=>this.loadingService.hide()});return}if(this.data.companyId&&this.treeTypeId!==void 0){this.target="company",this.treeService.getTreesByOwnerAndType(this.treeTypeId,void 0,this.data.companyId).subscribe({next:e=>this.trees=e,error:e=>console.error("Error cargando \xE1rboles de la compa\xF1\xEDa",e),complete:()=>this.loadingService.hide()});return}this.loadingService.hide(),console.error("\u274C No se proporcion\xF3 ni userId ni companyId al modal")}unassignTree(e){let n;this.target==="company"?n=this.treeService.unassignTreeFromCompany(e):n=this.treeService.unassignTreeFromUser(e),n.subscribe({next:()=>{this.trees=this.trees.filter(i=>i.id!==e)},error:i=>console.error("\u274C Error al desasignar \xE1rbol",i)})}viewTree(e){this.router.navigate(["/tree",e]),this.dialogRef.close({updated:!0})}editTree(e){this.router.navigate(["/tree/form",e]),this.dialogRef.close({updated:!0})}close(){this.dialogRef.close({updated:!0})}static{this.\u0275fac=function(n){return new(n||t)(m(R),m(O),m(N),m(L),m($))}}static{this.\u0275cmp=I({type:t,selectors:[["app-manage-trees-modal"]],standalone:!0,features:[b],decls:4,vars:6,consts:[["noTrees",""],[4,"ngIf"],["class","p-6 w-full max-w-md bg-white rounded-2xl shadow-lg",4,"ngIf"],[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[4,"ngIf","ngIfElse"],[1,"flex","justify-end","mt-6"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["class","flex justify-between items-center border-b py-2",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","border-b","py-2"],[1,"text-sm","text-gray-500"],[1,"font-semibold"],[1,"flex","gap-2"],[1,"bg-green-600","hover:bg-green-700","text-white","rounded-full","p-2","flex","items-center","justify-center",3,"click"],[1,"text-white",2,"font-size","20px"],[2,"font-size","20px"],[1,"bg-red-600","hover:bg-red-700","text-white","rounded-full","p-2","flex","items-center","justify-center",3,"click"],[1,"text-gray-500","italic"]],template:function(n,i){n&1&&(g(0,_e,1,0,"app-loading-spinner",1),d(1,"async"),g(2,he,11,8,"div",2),d(3,"async")),n&2&&(s("ngIf",p(1,2,i.loadingService.loading$)),r(2),s("ngIf",!p(3,4,i.loadingService.loading$)))},dependencies:[E,M,C,G,w,A,z,q,P],encapsulation:2})}}return t})();export{Ae as a,Ge as b};
