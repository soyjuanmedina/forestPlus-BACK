import{c as A,d as L,e as D,f as O,g as Q}from"./chunk-CW6BFJWS.js";import{Aa as o,Ac as P,Ba as a,Bc as g,Ca as S,Dc as V,Eb as B,Ec as j,Gb as M,Hc as k,Ja as b,Jc as q,Kc as G,La as x,M as U,Mc as z,Oc as H,Wa as d,Xa as f,Ya as _,da as y,db as F,ea as r,fa as u,fb as l,gb as s,na as v,qc as I,ra as p,rc as N,sb as C,vc as T,wb as R,wc as w,yd as W}from"./chunk-UX3E3RBF.js";function $(n,h){n&1&&(o(0,"div",18),d(1),l(2,"translate"),a()),n&2&&(r(),f(s(2,1,"USER.FIELD_REQUIRED")))}function J(n,h){n&1&&(o(0,"div",18),d(1),l(2,"translate"),a()),n&2&&(r(),f(s(2,1,"USER.FIELD_REQUIRED")))}function K(n,h){n&1&&(o(0,"div"),d(1),l(2,"translate"),a()),n&2&&(r(),f(s(2,1,"USER.FIELD_REQUIRED")))}function X(n,h){n&1&&(o(0,"div"),d(1),l(2,"translate"),a()),n&2&&(r(),_("",s(2,1,"USER.INVALID_EMAIL")," "))}function Z(n,h){if(n&1&&(o(0,"div",18),v(1,K,3,3,"div",19)(2,X,3,3,"div",19),a()),n&2){let t,e,i=x();r(),p("ngIf",(t=i.userForm.get("email"))==null?null:t.hasError("required")),r(),p("ngIf",(e=i.userForm.get("email"))==null?null:e.hasError("email"))}}function ee(n,h){n&1&&(o(0,"div",20),d(1),l(2,"translate"),a()),n&2&&(r(),_(" ",s(2,1,"USER.SUCCESS_MSG")," "))}function te(n,h){if(n&1&&(o(0,"div",21),d(1),a()),n&2){let t=x();r(),_(" ",t.registerError," ")}}var Ee=(()=>{class n{constructor(t,e,i,m,c,E,Y){this.fb=t,this.userService=e,this.authService=i,this.companyService=m,this.router=c,this.snackBar=E,this.route=Y,this.hidePassword=!0,this.roles=N,this.companies=[],this.registerSuccess=!1,this.registerError="",this.isEditMode=!1,this.isSelfEdit=!1,this.RolesEnum=I}ngOnInit(){this.currentUser=this.authService.getUser()??void 0,this.route.paramMap.subscribe(t=>{let e=t.get("id");e&&(this.isEditMode=!0,this.userId=+e,this.loadUser(this.userId))}),this.userForm=this.fb.group({name:["",g.required],surname:["",g.required],secondSurname:[""],email:["",[g.required,g.email]],password:["",[g.minLength(6)]],role:[null],companyId:[""]}),this.userForm.get("role")?.valueChanges.subscribe(t=>{let e=this.userForm.get("companyId");t===I.COMPANY_USER?(e?.setValidators([g.required]),e?.enable()):(e?.clearValidators(),e?.setValue(""),e?.disable()),e?.updateValueAndValidity()}),this.companyService.getAllCompanies().subscribe({next:t=>{this.companies=t.filter(e=>!!e.admin)},error:t=>console.error("Error cargando compa\xF1\xEDas",t)})}loadUser(t){this.userService.getUserById(t).subscribe({next:e=>{this.user=e,this.previewImage=e.picture,this.isSelfEdit=this.currentUser?.id===this.userId,this.userForm.patchValue({name:e.name,surname:e.surname,secondSurname:e.secondSurname,email:e.email,role:e.role,companyId:e.company?.id??""}),this.isSelfEdit?(this.userForm.get("role")?.disable(),this.userForm.get("companyId")?.disable(),this.userForm.get("password")?.disable()):this.userForm.get("email")?.disable()},error:e=>console.error("\u274C Error al cargar usuario",e)})}onFileSelected(t){let e=t.target.files[0];if(e){this.selectedFile=e;let i=new FileReader;i.onload=()=>this.previewImage=i.result,i.readAsDataURL(e)}}onSubmit(){if(this.userForm.invalid)return;let t=this.userForm.getRawValue(),e;this.selectedFile&&this.isEditMode?e=this.userService.updateUserPicture(this.userId,this.selectedFile):this.isEditMode?e=this.isSelfEdit?this.userService.updateUser(this.userId,t):this.userService.updateUserByAdmin(this.userId,t):e=this.userService.registerUserByAdmin(t),e.subscribe({next:i=>{this.finalizeUpdate(i)},error:i=>{this.registerError=i.error?.message||"Error al guardar usuario",this.registerSuccess=!1,console.error(i)}})}finalizeUpdate(t){this.user=t,this.previewImage=t.picture,this.selectedFile=void 0,this.snackBar.open("\u2705 Usuario actualizado con \xE9xito","Cerrar",{duration:3e3}),this.isSelfEdit?(this.authService.updateCurrentUser(t),this.router.navigate(["/profile"])):this.router.navigate(["/admin/users"])}static{this.\u0275fac=function(e){return new(e||n)(u(z),u(w),u(T),u(W),u(M),u(Q),u(B))}}static{this.\u0275cmp=U({type:n,selectors:[["app-user-form"]],standalone:!0,features:[F],decls:49,vars:41,consts:[[1,"max-w-2xl","mx-auto","bg-white","p-6","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","text-center","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4",3,"ngSubmit","formGroup"],[1,"md:col-span-2","flex","flex-col","items-center","mb-4"],["alt","Avatar",1,"w-24","h-24","rounded-full","shadow-lg","mb-2",3,"src"],[1,"cursor-pointer","bg-gray-200","hover:bg-gray-300","p-2","rounded-full","flex","items-center","gap-2"],["type","file","accept","image/*","hidden","",3,"change"],[1,"md:col-span-2"],[1,"block","text-gray-700","mb-1"],["type","text","formControlName","name",1,"w-full","px-4","py-2","border-b","border-gray-300","focus:border-green-500","focus:outline-none","bg-transparent",3,"placeholder"],["class","text-red-500 text-sm mt-1",4,"ngIf"],["type","text","formControlName","surname",1,"w-full","px-4","py-2","border-b","border-gray-300","focus:border-green-500","focus:outline-none","bg-transparent",3,"placeholder"],["type","text","formControlName","secondSurname",1,"w-full","px-4","py-2","border-b","border-gray-300","focus:border-green-500","focus:outline-none","bg-transparent",3,"placeholder"],["type","email","formControlName","email",1,"w-full","px-4","py-2","border-b","border-gray-300","focus:border-green-500","focus:outline-none","bg-transparent",3,"placeholder"],[1,"md:col-span-2","mt-4"],["type","submit",1,"w-full","bg-green-600","text-white","py-3","rounded-lg","hover:bg-green-700","disabled:opacity-50"],["class","text-center text-green-600 font-semibold text-lg mt-4",4,"ngIf"],["class","text-center text-red-500 mt-4",4,"ngIf"],[1,"text-red-500","text-sm","mt-1"],[4,"ngIf"],[1,"text-center","text-green-600","font-semibold","text-lg","mt-4"],[1,"text-center","text-red-500","mt-4"]],template:function(e,i){if(e&1&&(o(0,"div",0)(1,"h2",1),d(2),l(3,"translate"),l(4,"translate"),a(),o(5,"form",2),b("ngSubmit",function(){return i.onSubmit()}),o(6,"div",3),S(7,"img",4),o(8,"label",5)(9,"mat-icon"),d(10,"photo_camera"),a(),o(11,"span"),d(12,"Seleccionar foto"),a(),o(13,"input",6),b("change",function(c){return i.onFileSelected(c)}),a()()(),o(14,"div",7)(15,"label",8),d(16),l(17,"translate"),a(),S(18,"input",9),l(19,"translate"),v(20,$,3,3,"div",10),a(),o(21,"div")(22,"label",8),d(23),l(24,"translate"),a(),S(25,"input",11),l(26,"translate"),v(27,J,3,3,"div",10),a(),o(28,"div")(29,"label",8),d(30),l(31,"translate"),a(),S(32,"input",12),l(33,"translate"),a(),o(34,"div",7)(35,"label",8),d(36),l(37,"translate"),a(),S(38,"input",13),l(39,"translate"),v(40,Z,3,2,"div",10),a(),o(41,"div",14)(42,"button",15),d(43),l(44,"translate"),l(45,"translate"),a()()(),v(46,ee,3,3,"div",16)(47,te,2,1,"div",17),a(),d(48,"\n``")),e&2){let m,c,E;r(2),_(" ",i.isEditMode?s(3,17,"USER.EDIT_TITLE"):s(4,19,"USER.NEW_TITLE")," "),r(3),p("formGroup",i.userForm),r(2),p("src",i.previewImage||"assets/logo-white.png",y),r(9),f(s(17,21,"USER.NAME_LABEL")),r(2),p("placeholder",s(19,23,"USER.NAME_PLACEHOLDER")),r(2),p("ngIf",((m=i.userForm.get("name"))==null?null:m.invalid)&&((m=i.userForm.get("name"))==null?null:m.touched)),r(3),f(s(24,25,"USER.SURNAME_LABEL")),r(2),p("placeholder",s(26,27,"USER.SURNAME_PLACEHOLDER")),r(2),p("ngIf",((c=i.userForm.get("surname"))==null?null:c.invalid)&&((c=i.userForm.get("surname"))==null?null:c.touched)),r(3),f(s(31,29,"USER.SECOND_SURNAME_LABEL")),r(2),p("placeholder",s(33,31,"USER.SECOND_SURNAME_PLACEHOLDER")),r(4),f(s(37,33,"USER.EMAIL_LABEL")),r(2),p("placeholder",s(39,35,"USER.EMAIL_PLACEHOLDER")),r(2),p("ngIf",((E=i.userForm.get("email"))==null?null:E.invalid)&&((E=i.userForm.get("email"))==null?null:E.touched)),r(3),_(" ",i.isEditMode?s(44,37,"USER.EDIT_BUTTON"):s(45,39,"USER.CREATE_BUTTON")," "),r(3),p("ngIf",i.registerSuccess),r(),p("ngIf",i.registerError)}},dependencies:[R,C,H,k,P,V,j,q,G,L,A,O,D],styles:["[_nghost-%COMP%]{display:block;min-height:calc(100vh - 4rem);padding-top:2rem;background-color:#f3f4f6}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{transition:border-color .2s}"]})}}return n})();export{Ee as UserFormComponent};
