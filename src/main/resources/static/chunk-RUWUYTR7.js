import{a as Ee}from"./chunk-JRH64NRU.js";import{d as se,e as ye}from"./chunk-ZY4YBEG5.js";import{a as Y,b as Q,d as _e}from"./chunk-KXQKYNHU.js";import{a as W,b as X,c as ve,h as z}from"./chunk-CH7MP2HA.js";import{a as ce}from"./chunk-MTJFRQT6.js";import{a as xe}from"./chunk-UY5Q2ALM.js";import{a as Te}from"./chunk-3ROGCXZR.js";import{b as N}from"./chunk-VICIOZHW.js";import{a as D,b as _,d as F,e as O,h as R,i as w,k as B,l as P,m as ue,n as fe,o as ge,p as be,q as he,r as V,s as H,t as k}from"./chunk-YJY2IHGB.js";import{b as $}from"./chunk-WHLFGZ7J.js";import{Aa as h,Cb as M,Db as L,E as C,Fa as Z,Ga as p,Ha as g,Ia as m,J as T,Ja as oe,K as y,Pa as A,Ta as a,U as re,Ua as l,V as n,Va as ee,W as c,Wa as te,a as G,b as K,da as E,f as ie,fb as U,ga as u,gb as ae,kb as le,lb as S,m as ne,ma as o,na as r,oa as b,pc as me,sa as q,sb as de,ub as pe,v as I,va as f,xa as j}from"./chunk-RMY7DBIB.js";function we(d,v){if(d&1&&(o(0,"option",11),p(1),r()),d&2){let e=v.$implicit;u("value",e.id),n(),m(" ",e.name," ")}}var Me=(()=>{class d{constructor(e,t,i){this.fb=e,this.dialogRef=t,this.data=i,this.treeTypes=[],this.form=this.fb.group({treeTypeId:[null,_.required],quantity:[1,[_.required,_.min(1)]]})}ngOnInit(){this.treeTypes=this.data.treeTypes}submit(){this.form.invalid||this.dialogRef.close(this.form.value)}close(){this.dialogRef.close(null)}static{this.\u0275fac=function(t){return new(t||d)(c(V),c(W),c(X))}}static{this.\u0275cmp=C({type:d,selectors:[["app-plant-trees-modal"]],standalone:!0,features:[A],decls:24,vars:21,consts:[[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[3,"ngSubmit","formGroup"],[1,"mb-6"],[1,"block","text-gray-700","mb-1"],["formControlName","treeTypeId",1,"w-full","rounded-xl","border","border-gray-300","p-2"],[3,"value",4,"ngFor","ngForOf"],["type","number","formControlName","quantity","min","1",1,"w-full","px-0","py-2","border-b","border-gray-300","focus:border-green-500","bg-transparent","outline-none",3,"placeholder"],[1,"flex","justify-end","gap-4","mt-8"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50","transition",3,"disabled"],[3,"value"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"h2",1),p(2),a(3,"translate"),r(),o(4,"form",2),f("ngSubmit",function(){return i.submit()}),o(5,"div",3)(6,"label",4),p(7),a(8,"translate"),r(),o(9,"select",5),E(10,we,2,2,"option",6),r()(),o(11,"div",3)(12,"label",4),p(13),a(14,"translate"),r(),b(15,"input",7),a(16,"translate"),r(),o(17,"div",8)(18,"button",9),f("click",function(){return i.dialogRef.close()}),p(19),a(20,"translate"),r(),o(21,"button",10),p(22),a(23,"translate"),r()()()()),t&2&&(n(2),m(" ",l(3,9,"PLANT_TREES.TITLE")," "),n(2),u("formGroup",i.form),n(3),m(" ",l(8,11,"PLANT_TREES.TREE_TYPE")," "),n(3),u("ngForOf",i.treeTypes),n(3),m(" ",l(14,13,"PLANT_TREES.QUANTITY")," "),n(2),h("placeholder",l(16,15,"PLANT_TREES.QUANTITY_PLACEHOLDER")),n(4),m(" ",l(20,17,"COMMON.CANCEL")," "),n(2),u("disabled",i.form.invalid),n(),m(" ",l(23,19,"PLANT_TREES.PLANT")," "))},dependencies:[S,U,z,N,Y,_e,Q,H,R,fe,ge,D,w,ue,F,O,be,k,B,P,L,M,$],encapsulation:2})}}return d})();var Le=(()=>{class d{constructor(e,t,i){this.fb=e,this.dialogRef=t,this.data=i,this.form=this.fb.group({lat:[null,_.required],lng:[null,_.required]})}addCoordinate(){if(this.form.invalid)return;let e={latitude:this.form.value.lat,longitude:this.form.value.lng,landId:this.data.landId};this.dialogRef.close(e)}static{this.\u0275fac=function(t){return new(t||d)(c(V),c(W),c(X))}}static{this.\u0275cmp=C({type:d,selectors:[["app-add-coordinate-modal"]],standalone:!0,features:[A],decls:24,vars:23,consts:[[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[3,"ngSubmit","formGroup"],[1,"mb-6"],[1,"block","text-gray-700","mb-1"],["type","number","step","0.000001","formControlName","lat",1,"w-full","rounded-xl","border","border-gray-300","p-2",3,"placeholder"],["type","number","step","0.000001","formControlName","lng",1,"w-full","rounded-xl","border","border-gray-300","p-2",3,"placeholder"],[1,"flex","justify-end","gap-4","mt-8"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50","transition",3,"disabled"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"h2",1),p(2),a(3,"translate"),r(),o(4,"form",2),f("ngSubmit",function(){return i.addCoordinate()}),o(5,"div",3)(6,"label",4),p(7),a(8,"translate"),r(),b(9,"input",5),a(10,"translate"),r(),o(11,"div",3)(12,"label",4),p(13),a(14,"translate"),r(),b(15,"input",6),a(16,"translate"),r(),o(17,"div",7)(18,"button",8),f("click",function(){return i.dialogRef.close()}),p(19),a(20,"translate"),r(),o(21,"button",9),p(22),a(23,"translate"),r()()()()),t&2&&(n(2),m(" ",l(3,9,"ADD_COORDINATE.TITLE")," "),n(2),u("formGroup",i.form),n(3),m(" ",l(8,11,"ADD_COORDINATE.LATITUDE")," "),n(2),h("placeholder",l(10,13,"ADD_COORDINATE.LATITUDE_PLACEHOLDER")),n(4),m(" ",l(14,15,"ADD_COORDINATE.LONGITUDE")," "),n(2),h("placeholder",l(16,17,"ADD_COORDINATE.LONGITUDE_PLACEHOLDER")),n(4),m(" ",l(20,19,"COMMON.CANCEL")," "),n(2),u("disabled",i.form.invalid),n(),m(" ",l(23,21,"ADD_COORDINATE.SAVE")," "))},dependencies:[S,k,R,D,w,F,O,B,P,z,N,L,M],encapsulation:2})}}return d})();function Be(d,v){if(d&1){let e=q();o(0,"li",27)(1,"span"),p(2),a(3,"number"),a(4,"number"),r(),o(5,"div",28)(6,"button",29),f("click",function(){let i=T(e).$implicit,s=j(2);return y(s.deleteCoordinate(i))}),p(7),a(8,"translate"),r()()()}if(d&2){let e=v.$implicit;n(2),oe("Lat: ",ee(3,3,e.latitude,"1.6-6"),", Lng: ",ee(4,6,e.longitude,"1.6-6"),""),n(5),m(" ",l(8,9,"LAND_FORM.DELETE_COORDINATE")," ")}}function Pe(d,v){if(d&1&&(o(0,"ul"),E(1,Be,9,11,"li",26),r()),d&2){let e=j();n(),u("ngForOf",e.coordinates)}}function Ve(d,v){d&1&&(o(0,"p",30),p(1),a(2,"translate"),r()),d&2&&(n(),g(l(2,1,"LANDS.NO_COORDINATES")))}function ke(d,v){if(d&1){let e=q();o(0,"li",32)(1,"span"),p(2),r(),o(3,"div",28)(4,"span",33),p(5),r(),o(6,"button",34),f("click",function(){let i=T(e).$implicit,s=j(2);return y(s.editPlantedTrees(i))}),p(7),a(8,"translate"),r()()()}if(d&2){let e=v.$implicit;n(2),g(e.treeTypeName),n(3),g(e.quantity),n(2),m(" ",l(8,3,"LAND_FORM.EDIT_TREES")," ")}}function je(d,v){if(d&1&&(o(0,"ul"),E(1,ke,9,5,"li",31),r()),d&2){let e=j();n(),u("ngForOf",e.plantedTrees)}}function Ge(d,v){d&1&&(o(0,"p",35),p(1),a(2,"translate"),r()),d&2&&(n(),g(l(2,1,"LANDS.NO_PLANTED_TREES_IN_LAND")))}var yt=(()=>{class d{constructor(e,t,i,s,x,J,Ne,De,Fe,Oe){this.fb=e,this.landService=t,this.coordinateService=i,this.route=s,this.router=x,this.userService=J,this.treeService=Ne,this.treeTypeService=De,this.dialog=Fe,this.snackBar=Oe,this.land=null,this.coordinates=[],this.plantedTrees=[],this.destroy$=new ie}ngOnInit(){this.initForm();let e=Number(this.route.snapshot.paramMap.get("id"));e&&this.loadLand(e),this.userService.getUser().pipe(I(this.destroy$)).subscribe(t=>this.user=t)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initForm(){this.landForm=this.fb.group({name:["",_.required],location:[""],area:[0,_.required],maxTrees:[0]})}loadLand(e){this.landService.getLandById(e).pipe(I(this.destroy$)).subscribe(t=>{this.land=t,this.landForm.patchValue({name:t.name,location:t.location,area:t.area,maxTrees:t.maxTrees}),this.previewImage=t.picture,this.loadCoordinates(),this.loadPlantedTrees(e)})}onFileSelected(e){let t=e.target.files[0];if(!t)return;this.selectedFile=t;let i=new FileReader;i.onload=()=>this.previewImage=i.result,i.readAsDataURL(t)}onSubmitLand(){if(this.landForm.invalid)return;let e=this.landForm.value,t=[];if(this.land?.id){let i=K(G({},e),{picture:this.previewImage});t.push(this.landService.updateLand(this.land.id,i))}else{let i=K(G({},e),{userIds:[],companyIds:[],picture:this.previewImage});t.push(this.landService.createLand(i))}ne(t).pipe(I(this.destroy$)).subscribe(i=>{let s=i[i.length-1];s&&(this.land=s,this.landForm.patchValue({name:s.name,location:s.location,area:s.area,maxTrees:s.maxTrees}),this.previewImage=s.picture,this.selectedFile=void 0,this.user&&(this.user.role==="ADMIN"?this.router.navigate(["/admin/lands"]):this.user.role==="COMPANY_ADMIN"?this.router.navigate(["/land"]):this.router.navigate(["/home"])))})}cancel(){this.user&&(this.user.role==="ADMIN"?this.router.navigate(["/admin/lands"]):this.user.role==="COMPANY_ADMIN"?this.router.navigate(["/land"]):this.router.navigate(["/home"]))}loadCoordinates(){this.land?.id&&this.landService.getCoordinatesByLand(this.land.id).pipe(I(this.destroy$)).subscribe(e=>this.coordinates=e)}openAddCoordinateModal(){if(!this.land?.id)return;this.dialog.open(Le,{width:"400px",data:{landId:this.land.id}}).afterClosed().subscribe(t=>{t&&this.saveCoordinate(G({},t))})}saveCoordinate(e){this.coordinateService.createCoordinate(e).subscribe({next:t=>this.coordinates.push(t),error:t=>console.error("Error al guardar coordenada",t)})}loadPlantedTrees(e){this.treeService.getTreesByLand(e).subscribe({next:t=>this.plantedTrees=t,error:t=>this.snackBar.open("Error cargando \xE1rboles plantados","Cerrar",{duration:3e3})})}openPlantTreesModal(){this.land?.id&&this.treeTypeService.getAllTreeTypes().pipe(I(this.destroy$)).subscribe({next:e=>{this.dialog.open(Me,{width:"400px",data:{treeTypes:e}}).afterClosed().subscribe(i=>{i&&this.land?.id&&this.treeService.plantTreeBatch({landId:this.land.id,treeTypeId:i.treeTypeId,quantity:i.quantity}).subscribe(()=>this.loadPlantedTrees(this.land.id))})},error:e=>console.error("Error cargando tipos de \xE1rboles",e)})}editPlantedTrees(e){this.router.navigate(["/land/edit-trees",this.land?.id,e.treeTypeId])}deleteCoordinate(e){if(!e.id){console.error("La coordenada no tiene ID, no se puede eliminar");return}this.coordinateService.deleteCoordinate(e.id).subscribe({next:()=>this.loadCoordinates(),error:t=>console.error("Error al guardar coordenada",t)})}static{this.\u0275fac=function(t){return new(t||d)(c(V),c(ye),c(Ee),c(de),c(pe),c(se),c(ce),c(Te),c(ve),c(xe))}}static{this.\u0275cmp=C({type:d,selectors:[["app-land-form"]],standalone:!0,features:[A],decls:71,vars:58,consts:[["noCoordinates",""],["noPlantedTrees",""],[1,"w-full","max-w-full","mx-auto","bg-white","p-6","rounded-2xl","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"text-2xl","font-bold","mb-6","text-center"],[1,"flex","flex-col","items-center","mb-6"],["alt","Imagen del terreno",1,"w-24","h-24","rounded-full","shadow-lg","mb-2","object-cover",3,"src"],[1,"cursor-pointer","bg-gray-200","hover:bg-gray-300","p-2","rounded-full","flex","items-center","gap-2"],[1,"material-icons"],["type","file","accept","image/*","hidden","",3,"change"],[1,"flex","flex-col","md:flex-row","gap-4","mb-6"],[1,"flex-1"],[1,"block","text-gray-700","font-medium","mb-1"],["type","text","formControlName","name","required","",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],["type","text","formControlName","location",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],["type","number","formControlName","area","required","",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],["type","number","formControlName","maxTrees",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],[1,"flex","justify-end","gap-4","mt-6"],["type","button",1,"flex-1","bg-gray-300","text-gray-700","py-3","rounded-xl","hover:bg-gray-400","transition",3,"click"],["type","submit",1,"flex-1","bg-green-600","text-white","py-3","rounded-xl","hover:bg-green-700","disabled:opacity-50","transition"],[1,"mt-6","w-full","text-left"],[1,"flex","justify-between","items-center","mb-2"],[1,"font-semibold","text-gray-700"],["type","button",1,"bg-blue-200","text-blue-800","px-3","py-1","rounded-full","hover:bg-blue-300","transition","text-sm",3,"click"],[4,"ngIf","ngIfElse"],["type","button",1,"bg-green-200","text-green-800","px-3","py-1","rounded-full","hover:bg-green-300","transition","text-sm",3,"click"],["class","flex justify-between border-b py-1",4,"ngFor","ngForOf"],[1,"flex","justify-between","border-b","py-1"],[1,"flex","items-center","gap-2"],["type","button",1,"bg-red-200","text-red-800","px-2","py-1","rounded-full","hover:bg-red-300","transition","text-sm",3,"click"],[1,"text-gray-400"],["class","flex justify-between items-center border-b py-1",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","border-b","py-1"],[1,"font-semibold"],["type","button",1,"bg-blue-200","text-blue-800","px-2","py-1","rounded-full","hover:bg-blue-300","transition","text-sm",3,"click"],[1,"text-gray-500","italic"]],template:function(t,i){if(t&1){let s=q();o(0,"div",2)(1,"form",3),f("ngSubmit",function(){return T(s),y(i.onSubmitLand())}),o(2,"h1",4),p(3),a(4,"translate"),a(5,"translate"),r(),o(6,"div",5),b(7,"img",6),o(8,"label",7)(9,"span",8),p(10,"photo_camera"),r(),o(11,"span"),p(12),a(13,"translate"),r(),o(14,"input",9),f("change",function(J){return T(s),y(i.onFileSelected(J))}),r()()(),o(15,"div",10)(16,"div",11)(17,"label",12),p(18),a(19,"translate"),r(),b(20,"input",13),a(21,"translate"),r(),o(22,"div",11)(23,"label",12),p(24),a(25,"translate"),r(),b(26,"input",14),a(27,"translate"),r()(),o(28,"div",10)(29,"div",11)(30,"label",12),p(31),a(32,"translate"),r(),b(33,"input",15),a(34,"translate"),r(),o(35,"div",11)(36,"label",12),p(37),a(38,"translate"),r(),b(39,"input",16),a(40,"translate"),r()(),o(41,"div",17)(42,"button",18),f("click",function(){return T(s),y(i.cancel())}),p(43),a(44,"translate"),r(),o(45,"button",19),p(46),a(47,"translate"),a(48,"translate"),r()(),o(49,"div",20)(50,"div",21)(51,"p",22),p(52),a(53,"translate"),r(),o(54,"button",23),f("click",function(){return T(s),y(i.openAddCoordinateModal())}),p(55),a(56,"translate"),r()(),E(57,Pe,2,1,"ul",24)(58,Ve,3,3,"ng-template",null,0,te),r(),o(60,"div",20)(61,"div",21)(62,"p",22),p(63),a(64,"translate"),r(),o(65,"button",25),f("click",function(){return T(s),y(i.openPlantTreesModal())}),p(66),a(67,"translate"),r()(),E(68,je,2,1,"ul",24)(69,Ge,3,3,"ng-template",null,1,te),r()()()}if(t&2){let s=Z(59),x=Z(70);n(),u("formGroup",i.landForm),n(2),m(" ",i.land!=null&&i.land.id?l(4,22,"LAND_FORM.TITLE_EDIT"):l(5,24,"LAND_FORM.TITLE_NEW")," "),n(4),u("src",i.previewImage||"assets/logo-white.png",re),n(5),g(l(13,26,"LAND_FORM.SELECT_IMAGE")),n(6),g(l(19,28,"LAND_FORM.NAME_LABEL")),n(2),h("placeholder",l(21,30,"LAND_FORM.NAME_PLACEHOLDER")),n(4),g(l(25,32,"LAND_FORM.LOCATION_LABEL")),n(2),h("placeholder",l(27,34,"LAND_FORM.LOCATION_PLACEHOLDER")),n(5),g(l(32,36,"LAND_FORM.AREA_LABEL")),n(2),h("placeholder",l(34,38,"LAND_FORM.AREA_PLACEHOLDER")),n(4),g(l(38,40,"LAND_FORM.MAX_TREES_LABEL")),n(2),h("placeholder",l(40,42,"LAND_FORM.MAX_TREES_PLACEHOLDER")),n(4),m(" ",l(44,44,"LAND_FORM.CANCEL_BUTTON")," "),n(3),m(" ",i.land!=null&&i.land.id?l(47,46,"LAND_FORM.SUBMIT_EDIT"):l(48,48,"LAND_FORM.SUBMIT_NEW")," "),n(6),g(l(53,50,"LANDS.COORDINATES")),n(3),m(" ",l(56,52,"LAND_FORM.ADD_COORDINATE")," "),n(2),u("ngIf",i.coordinates==null?null:i.coordinates.length)("ngIfElse",s),n(6),g(l(64,54,"LANDS.PLANTED_TREES")),n(3),m(" ",l(67,56,"LAND_FORM.PLANT_TREES")," "),n(2),u("ngIf",i.plantedTrees==null?null:i.plantedTrees.length)("ngIfElse",x)}},dependencies:[S,U,ae,le,H,R,D,w,F,O,he,k,B,P,$,N,Y,Q,me,L,M],encapsulation:2})}}return d})();export{yt as LandFormComponent};
