import{b as de}from"./chunk-GBXYDTAZ.js";import{a as ce,b as me,c as ue}from"./chunk-T7JQ6OOA.js";import{e as se,g as pe}from"./chunk-VR2SS2MG.js";import{a as J}from"./chunk-ANM5QR2G.js";import{a as fe}from"./chunk-VUDJFFTR.js";import"./chunk-I6AMTEEF.js";import{a as H,b as q}from"./chunk-U3KJZSAD.js";import{b as A,d as F,f as k,g as K,i as Q,j as Z,k as ee,l as te,m as ie,n as ne,o as re,p as oe,s as ae,t as O,u as le}from"./chunk-T2CGB3F3.js";import{a as Y,b as X}from"./chunk-LGEN4PPC.js";import{Ca as C,Fa as m,Ha as u,Hb as G,J as y,Jb as W,Ka as I,O as T,P as x,Qb as N,Rb as P,Sa as l,Ta as v,Ua as f,Va as h,Ya as V,Za as B,_a as j,a as D,ab as S,ba as n,ca as g,cb as L,fb as p,gb as d,ma as b,qa as c,sb as U,tb as w,ub as $,wa as i,xa as r,xb as z,ya as E,zb as M}from"./chunk-P2JR76SF.js";function he(a,_){if(a&1&&(i(0,"option",12),l(1),r()),a&2){let e=_.$implicit;c("value",e.id),n(),f(" ",e.name," ")}}var ge=(()=>{class a{constructor(e,o,t,s){this.data=e,this.dialogRef=o,this.fb=t,this.treeTypeService=s,this.treeTypes=[],this.form=this.fb.group({treeTypeId:[e.tree.treeTypeId,F.required],scientificName:[e.tree.scientificName],plantedAt:[e.tree.plantedAt,F.required],co2AbsorptionAt20:[{value:e.tree.co2AbsorptionAt20,disabled:!0}]}),this.loadTreeTypes()}loadTreeTypes(){this.treeTypeService.getAllTreeTypes().subscribe(e=>{this.treeTypes=e,this.onTreeTypeChange()})}onTreeTypeChange(){let e=this.form.get("treeTypeId")?.value,o=this.treeTypes.find(t=>t.id===e);o&&this.form.get("co2AbsorptionAt20")?.setValue(o.co2AbsorptionAt20)}save(){if(this.form.invalid)return;let e=D({},this.form.getRawValue());this.dialogRef.close(e)}close(){this.dialogRef.close()}static{this.\u0275fac=function(o){return new(o||a)(g(me),g(ce),g(ae),g(fe))}}static{this.\u0275cmp=y({type:a,selectors:[["app-edit-tree-modal"]],standalone:!0,features:[S],decls:30,vars:27,consts:[[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[3,"ngSubmit","formGroup"],[1,"block","text-gray-700","mb-1"],["formControlName","treeTypeId",1,"w-full","mb-4","border","rounded-xl","p-2",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","scientificName",1,"w-full","mb-4","border","rounded-xl","p-2",3,"placeholder"],["type","date","formControlName","plantedAt",1,"w-full","mb-4","border","rounded-xl","p-2"],["type","number","formControlName","co2AbsorptionAt20","readonly","",1,"w-full","mb-6","border","rounded-xl","p-2","bg-gray-100"],[1,"flex","justify-end","gap-4"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50","transition",3,"disabled"],[3,"value"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"h2",1),l(2),p(3,"translate"),r(),i(4,"form",2),m("ngSubmit",function(){return t.save()}),i(5,"label",3),l(6),p(7,"translate"),r(),i(8,"select",4),m("change",function(){return t.onTreeTypeChange()}),b(9,he,2,2,"option",5),r(),i(10,"label",3),l(11),p(12,"translate"),r(),E(13,"input",6),p(14,"translate"),i(15,"label",3),l(16),p(17,"translate"),r(),E(18,"input",7),i(19,"label",3),l(20),p(21,"translate"),r(),E(22,"input",8),i(23,"div",9)(24,"button",10),m("click",function(){return t.close()}),l(25),p(26,"translate"),r(),i(27,"button",11),l(28),p(29,"translate"),r()()()()),o&2&&(n(2),f(" ",d(3,11,"EDIT_TREE.TITLE")," "),n(2),c("formGroup",t.form),n(2),v(d(7,13,"EDIT_TREE.TYPE")),n(3),c("ngForOf",t.treeTypes),n(2),v(d(12,15,"EDIT_TREE.scientificName")),n(2),I("placeholder",d(14,17,"EDIT_TREE.scientificName_PLACEHOLDER")),n(3),v(d(17,19,"EDIT_TREE.PLANTED_AT")),n(4),v(d(21,21,"EDIT_TREE.CO2")),n(5),f(" ",d(26,23,"COMMON.CANCEL")," "),n(2),c("disabled",t.form.invalid),n(),f(" ",d(29,25,"COMMON.SAVE")," "))},dependencies:[M,w,O,Z,re,oe,A,ee,ne,k,K,le,te,ie,P,N,se,pe,de],styles:[".mat-dialog-container[_ngcontent-%COMP%]{max-height:9vh;overflow-y:auto;border-radius:1rem;padding:0;background:transparent}.plant-modal[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .plant-modal[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border-radius:0!important}"]})}}return a})();var ye=a=>({"border-green-600 bg-green-50":a});function Ee(a,_){if(a&1){let e=C();i(0,"button",21),m("click",function(){T(e);let t=u(2).$implicit,s=u();return x(s.goToUser(t.ownerUserId))}),l(1),r()}if(a&2){let e=u(2).$implicit;n(),f(" ",e.ownerUserName," ")}}function Ce(a,_){if(a&1){let e=C();i(0,"button",21),m("click",function(){T(e);let t=u(2).$implicit,s=u();return x(s.goToCompany(t.ownerCompanyId))}),l(1),r()}if(a&2){let e=u(2).$implicit;n(),f(" ",e.ownerCompanyName," ")}}function Ie(a,_){if(a&1&&(i(0,"div",19)(1,"strong"),l(2),p(3,"translate"),r(),b(4,Ee,2,1,"button",20)(5,Ce,2,1,"button",20),r()),a&2){let e=u().$implicit;n(2),f("",d(3,3,"TREE_LIST.OWNER"),":"),n(2),c("ngIf",e.ownerUserId),n(),c("ngIf",e.ownerCompanyId)}}function Se(a,_){if(a&1){let e=C();i(0,"div",8)(1,"div",9)(2,"div",10),l(3),p(4,"translate"),r(),i(5,"div",11),l(6),p(7,"translate"),r(),i(8,"div",12),l(9),p(10,"translate"),p(11,"date"),r(),b(12,Ie,6,5,"div",13),r(),i(13,"div",14)(14,"button",15),m("click",function(){let t=T(e).$implicit,s=u();return x(s.viewTree(t.id))}),i(15,"mat-icon",16),l(16,"visibility"),r()(),i(17,"button",15),m("click",function(){let t=T(e).$implicit,s=u();return x(s.editTree(t.id))}),i(18,"mat-icon",17),l(19,"edit"),r()(),i(20,"button",18),m("click",function(){let t=T(e).$implicit,s=u();return x(s.deleteTree(t))}),i(21,"mat-icon",16),l(22,"delete"),r()()()()}if(a&2){let e=_.$implicit;c("ngClass",L(16,ye,e.ownerUserName||e.ownerCompanyName)),n(3),h(" ",d(4,8,"TREE_LIST.ID"),": ",e.id," "),n(3),h(" ",d(7,10,"TREE_LIST.TYPE"),": ",e.treeTypeName," "),n(3),h(" ",d(10,12,"TREE_LIST.PLANTED_AT"),": ",d(11,14,e.plantedAt)," "),n(3),c("ngIf",e.ownerUserName||e.ownerCompanyName)}}var qe=(()=>{class a{constructor(e,o,t,s){this.treeService=e,this.dialog=o,this.router=t,this.route=s,this.trees=[],this.filteredTrees=[],this.filterText="",this.currentPage=0,this.pageSize=10,this.totalPages=1}ngOnInit(){this.loadTrees()}loadTrees(){let e=Number(this.route.snapshot.paramMap.get("landId")),o=Number(this.route.snapshot.paramMap.get("treeTypeId"));this.treeService.getTreesByLandAndType(e,o).subscribe(t=>{this.trees=t,this.applyFilter()})}applyFilter(){let e=this.filterText.toLowerCase();this.filteredTrees=this.trees.filter(o=>(o.treeTypeName||"").toLowerCase().includes(e)||(o.id+"").includes(e)),this.currentPage=0,this.totalPages=Math.ceil(this.filteredTrees.length/this.pageSize)}getPagedTrees(){let e=this.currentPage*this.pageSize;return this.filteredTrees.slice(e,e+this.pageSize)}previousPage(){this.currentPage>0&&this.currentPage--}nextPage(){this.currentPage+1<this.totalPages&&this.currentPage++}openEditModal(e){this.dialog.open(ge,{width:"400px",data:{tree:e||null}}).afterClosed().subscribe(t=>{t&&this.loadTrees()})}viewTree(e){this.router.navigate(["/tree",e])}editTree(e){this.router.navigate(["/tree/form",e])}deleteTree(e){if(!e.id){console.error("El \xE1rbol no tiene ID, no se puede eliminar");return}this.treeService.deleteTree(e.id).subscribe(()=>this.loadTrees())}goToUser(e){this.router.navigate(["/profile/",e])}goToCompany(e){this.router.navigate(["/company/",e])}static{this.\u0275fac=function(o){return new(o||a)(g(J),g(ue),g(W),g(G))}}static{this.\u0275cmp=y({type:a,selectors:[["app-edit-trees"]],standalone:!0,features:[S],decls:19,vars:15,consts:[[1,"p-4"],[1,"flex","justify-between","items-center","mb-4"],["type","text",1,"w-64","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"ngModelChange","keyup","placeholder","ngModel"],[1,"flex","flex-col","gap-4"],["class","border rounded p-4 shadow-sm flex justify-between items-center w-full transition",3,"ngClass",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-center","items-center","gap-4"],[1,"flex","items-center","justify-center","gap-2","bg-green-600","text-white","py-2","px-4","rounded-xl","hover:bg-green-700","disabled:opacity-50","transition",3,"click","disabled"],[1,"text-gray-700","font-medium"],[1,"border","rounded","p-4","shadow-sm","flex","justify-between","items-center","w-full","transition",3,"ngClass"],[1,"flex","flex-col","text-left"],[1,"font-semibold","text-lg"],[1,"text-gray-600"],[1,"text-gray-500","text-sm"],["class","mt-2 p-2 bg-green-100 border border-green-500 rounded-lg text-green-800 text-sm flex items-center gap-1",4,"ngIf"],[1,"flex","gap-2"],[1,"bg-green-600","hover:bg-green-700","text-white","rounded-full","p-2","flex","items-center","justify-center",3,"click"],[1,"text-white",2,"font-size","20px"],[2,"font-size","20px"],[1,"bg-red-500","hover:bg-red-600","text-white","rounded-full","p-2","flex","items-center","justify-center",3,"click"],[1,"mt-2","p-2","bg-green-100","border","border-green-500","rounded-lg","text-green-800","text-sm","flex","items-center","gap-1"],["class","text-green-700 underline hover:text-green-900",3,"click",4,"ngIf"],[1,"text-green-700","underline","hover:text-green-900",3,"click"]],template:function(o,t){o&1&&(i(0,"mat-card",0)(1,"div",1)(2,"input",2),p(3,"translate"),j("ngModelChange",function(R){return B(t.filterText,R)||(t.filterText=R),R}),m("keyup",function(){return t.applyFilter()}),r()(),i(4,"div",3),b(5,Se,23,18,"div",4),r(),i(6,"div",5)(7,"button",6),m("click",function(){return t.previousPage()}),i(8,"mat-icon"),l(9,"chevron_left"),r(),l(10),p(11,"translate"),r(),i(12,"span",7),l(13),r(),i(14,"button",6),m("click",function(){return t.nextPage()}),l(15),p(16,"translate"),i(17,"mat-icon"),l(18,"chevron_right"),r()()()()),o&2&&(n(2),I("placeholder",d(3,9,"TREE_LIST.SEARCH_PLACEHOLDER")),V("ngModel",t.filterText),n(3),c("ngForOf",t.getPagedTrees()),n(2),c("disabled",t.currentPage===0),n(3),f(" ",d(11,11,"COMMON.PREVIOUS")," "),n(3),h(" ",t.currentPage+1," / ",t.totalPages," "),n(),c("disabled",t.currentPage+1>=t.totalPages),n(),f(" ",d(16,13,"COMMON.NEXT")," "))},dependencies:[M,U,w,$,z,O,A,k,Q,X,Y,q,H,P,N],styles:[`@charset "UTF-8";.tree-action-button{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background-color:#e0e0ff;color:#00006e;transition:background-color .2s}.tree-action-button:hover{background-color:#1cc07d}.tree-action-button mat-icon{font-size:24px}.tree-action-button.delete{background-color:#f87171}.tree-action-button.delete:hover{background-color:#ef4444}
`],encapsulation:2})}}return a})();export{qe as EditTreesComponent};
