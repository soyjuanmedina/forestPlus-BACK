import{a as xe,b as _e}from"./chunk-MYYDGBFD.js";import{c as re}from"./chunk-SX3BAX22.js";import{a as ve}from"./chunk-5ZRNQWS5.js";import{a as me,b as ce,c as ue,h as fe}from"./chunk-T7JQ6OOA.js";import"./chunk-33AZJERS.js";import{a as be}from"./chunk-3TRV4NIH.js";import{e as se,g as pe}from"./chunk-VR2SS2MG.js";import{a as ae}from"./chunk-ANM5QR2G.js";import{a as ge}from"./chunk-JN5OTYKR.js";import{a as he}from"./chunk-VUDJFFTR.js";import"./chunk-I6AMTEEF.js";import{a as ie,b as ne}from"./chunk-U3KJZSAD.js";import{b as N}from"./chunk-LITGK74X.js";import{b as T,d as I,f as w,g as F,j as O,k as R,l as B,m as P,r as le,s as V,t as de,u as j}from"./chunk-T2CGB3F3.js";import{b as oe}from"./chunk-LGEN4PPC.js";import{A as C,Ca as $,Fa as u,Ha as q,Hb as ee,J as A,Jb as te,Ka as h,O as v,P as b,Qb as D,Ra as Y,Rb as M,Sa as d,Ta as _,Ua as c,a as y,aa as X,ab as L,b as G,ba as r,ca as m,fb as a,gb as l,h as z,hb as H,ib as J,ma as U,p as W,qa as f,tb as K,ub as Q,wa as o,xa as n,ya as g,yb as Z,zb as S}from"./chunk-P2JR76SF.js";var Ie=(()=>{class p{constructor(e,t,i){this.fb=e,this.dialogRef=t,this.data=i,this.form=this.fb.group({lat:[null,I.required],lng:[null,I.required]})}addCoordinate(){if(this.form.invalid)return;let e={latitude:this.form.value.lat,longitude:this.form.value.lng,landId:this.data.landId};this.dialogRef.close(e)}static{this.\u0275fac=function(t){return new(t||p)(m(V),m(me),m(ce))}}static{this.\u0275cmp=A({type:p,selectors:[["app-add-coordinate-modal"]],standalone:!0,features:[L],decls:24,vars:23,consts:[[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[3,"ngSubmit","formGroup"],[1,"mb-6"],[1,"block","text-gray-700","mb-1"],["type","number","step","0.000001","formControlName","lat",1,"w-full","rounded-xl","border","border-gray-300","p-2",3,"placeholder"],["type","number","step","0.000001","formControlName","lng",1,"w-full","rounded-xl","border","border-gray-300","p-2",3,"placeholder"],[1,"flex","justify-end","gap-4","mt-8"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50","transition",3,"disabled"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"h2",1),d(2),a(3,"translate"),n(),o(4,"form",2),u("ngSubmit",function(){return i.addCoordinate()}),o(5,"div",3)(6,"label",4),d(7),a(8,"translate"),n(),g(9,"input",5),a(10,"translate"),n(),o(11,"div",3)(12,"label",4),d(13),a(14,"translate"),n(),g(15,"input",6),a(16,"translate"),n(),o(17,"div",7)(18,"button",8),u("click",function(){return i.dialogRef.close()}),d(19),a(20,"translate"),n(),o(21,"button",9),d(22),a(23,"translate"),n()()()()),t&2&&(r(2),c(" ",l(3,9,"ADD_COORDINATE.TITLE")," "),r(2),f("formGroup",i.form),r(3),c(" ",l(8,11,"ADD_COORDINATE.LATITUDE")," "),r(2),h("placeholder",l(10,13,"ADD_COORDINATE.LATITUDE_PLACEHOLDER")),r(4),c(" ",l(14,15,"ADD_COORDINATE.LONGITUDE")," "),r(2),h("placeholder",l(16,17,"ADD_COORDINATE.LONGITUDE_PLACEHOLDER")),r(4),c(" ",l(20,19,"COMMON.CANCEL")," "),r(2),f("disabled",i.form.invalid),r(),c(" ",l(23,21,"ADD_COORDINATE.SAVE")," "))},dependencies:[S,j,O,T,R,w,F,B,P,fe,N,M,D],encapsulation:2})}}return p})();function Te(p,k){if(p&1){let e=$();o(0,"div",28)(1,"div",29)(2,"p")(3,"span",30),d(4,"Lat:"),n(),d(5),a(6,"number"),n(),o(7,"p")(8,"span",30),d(9,"Lng:"),n(),d(10),a(11,"number"),n()(),o(12,"div",31)(13,"button",32),u("click",function(){let i=v(e).$implicit,s=q(2);return b(s.deleteCoordinate(i))}),o(14,"mat-icon",33),d(15,"delete"),n()()()()}if(p&2){let e=k.$implicit;r(5),c(" ",H(6,2,e.latitude,"1.6-6"),""),r(5),c(" ",H(11,5,e.longitude,"1.6-6"),"")}}function we(p,k){if(p&1&&(o(0,"div",26),U(1,Te,16,8,"div",27),n()),p&2){let e=q();r(),f("ngForOf",e.coordinates)}}function Fe(p,k){p&1&&(o(0,"p",34),d(1),a(2,"translate"),n()),p&2&&(r(),c(" ",l(2,1,"LANDS.NO_COORDINATES")," "))}var lt=(()=>{class p{constructor(e,t,i,s,x,E,Ee,Ce,ye,Ae,Le){this.fb=e,this.landService=t,this.plannedPlantationService=i,this.coordinateService=s,this.route=x,this.router=E,this.userService=Ee,this.treeService=Ce,this.treeTypeService=ye,this.dialog=Ae,this.snackBar=Le,this.land=null,this.coordinates=[],this.plannedPlantations=[],this.destroy$=new z}ngOnInit(){this.initForm();let e=Number(this.route.snapshot.paramMap.get("id"));e&&this.loadLand(e),this.userService.getUser().pipe(C(this.destroy$)).subscribe(t=>this.user=t)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initForm(){this.landForm=this.fb.group({name:["",I.required],location:[""],area:[0,I.required],maxTrees:[0]})}loadLand(e){this.landService.getLandById(e).pipe(C(this.destroy$)).subscribe(t=>{this.land=t,this.landForm.patchValue({name:t.name,location:t.location,area:t.area,maxTrees:t.maxTrees}),this.previewImage=t.picture,this.loadCoordinates(),this.loadPlannedPlantations()})}onFileSelected(e){let t=e.target.files[0];if(!t)return;this.selectedFile=t;let i=new FileReader;i.onload=()=>this.previewImage=i.result,i.readAsDataURL(t)}onSubmitLand(){if(this.landForm.invalid)return;let e=this.landForm.value,t=[];if(this.land?.id){let i=G(y({},e),{picture:this.previewImage});t.push(this.landService.updateLand(this.land.id,i))}else{let i=G(y({},e),{userIds:[],companyIds:[],picture:this.previewImage});t.push(this.landService.createLand(i))}W(t).pipe(C(this.destroy$)).subscribe(i=>{let s=i[i.length-1];s&&(this.land=s,this.landForm.patchValue({name:s.name,location:s.location,area:s.area,maxTrees:s.maxTrees}),this.previewImage=s.picture,this.selectedFile=void 0,this.user&&(this.user.role==="ADMIN"?this.router.navigate(["/admin/lands"]):this.user.role==="COMPANY_ADMIN"?this.router.navigate(["/land"]):this.router.navigate(["/home"])))})}cancel(){this.user&&(this.user.role==="ADMIN"?this.router.navigate(["/admin/lands"]):this.user.role==="COMPANY_ADMIN"?this.router.navigate(["/land"]):this.router.navigate(["/home"]))}loadCoordinates(){this.land?.id&&this.landService.getCoordinatesByLand(this.land.id).pipe(C(this.destroy$)).subscribe(e=>this.coordinates=e)}openAddCoordinateModal(){if(!this.land?.id)return;this.dialog.open(Ie,{width:"400px",data:{landId:this.land.id}}).afterClosed().subscribe(t=>{t&&this.saveCoordinate(y({},t))})}saveCoordinate(e){this.coordinateService.createCoordinate(e).subscribe({next:t=>this.coordinates.push(t),error:t=>console.error("Error al guardar coordenada",t)})}loadPlannedPlantations(){this.land?.id&&this.plannedPlantationService.getByLand(this.land.id).subscribe({next:e=>this.plannedPlantations=e,error:e=>console.error("Error cargando plantaciones",e)})}onEditPlantation(e){e.id&&this.router.navigate(["/admin/planned-plantation-form",e.id])}editPlantedTrees(e){this.router.navigate(["/land/edit-trees",this.land?.id,e.treeTypeId])}deleteCoordinate(e){if(!e.id){console.error("La coordenada no tiene ID, no se puede eliminar");return}this.coordinateService.deleteCoordinate(e.id).subscribe({next:()=>this.loadCoordinates(),error:t=>console.error("Error al guardar coordenada",t)})}static{this.\u0275fac=function(t){return new(t||p)(m(V),m(ve),m(be),m(_e),m(ee),m(te),m(re),m(ae),m(he),m(ue),m(ge))}}static{this.\u0275cmp=A({type:p,selectors:[["app-land-form"]],standalone:!0,features:[L],decls:62,vars:52,consts:[["noCoordinates",""],[1,"w-full","max-w-full","mx-auto","bg-white","p-6","rounded-2xl","shadow-lg"],[3,"ngSubmit","formGroup"],[1,"text-2xl","font-bold","mb-6","text-center"],[1,"flex","flex-col","items-center","mb-6"],["alt","Imagen del terreno",1,"w-24","h-24","rounded-full","shadow-lg","mb-2","object-cover",3,"src"],[1,"cursor-pointer","bg-gray-200","hover:bg-gray-300","p-2","rounded-full","flex","items-center","gap-2"],[1,"material-icons"],["type","file","accept","image/*","hidden","",3,"change"],[1,"flex","flex-col","md:flex-row","gap-4","mb-6"],[1,"flex-1"],[1,"block","text-gray-700","font-medium","mb-1"],["type","text","formControlName","name","required","",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],["type","text","formControlName","location",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],["type","number","formControlName","area","required","",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],["type","number","formControlName","maxTrees",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"placeholder"],[1,"flex","justify-end","gap-4","mt-6"],["type","button",1,"flex-1","bg-gray-300","text-gray-700","py-3","rounded-xl","hover:bg-gray-400","transition",3,"click"],["type","submit",1,"flex-1","bg-green-600","text-white","py-3","rounded-xl","hover:bg-green-700","disabled:opacity-50","transition"],[1,"mt-6","w-full","text-left"],[1,"flex","justify-between","items-center","mb-4"],[1,"font-semibold","text-gray-700"],["type","button",1,"bg-blue-200","text-blue-800","px-3","py-1","rounded-full","hover:bg-blue-300","transition","text-sm",3,"click"],["class","grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",4,"ngIf","ngIfElse"],[1,"mt-6","w-full"],[3,"edit","plantations","editable"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],["class","bg-white rounded-xl shadow-sm border p-4 flex flex-col justify-between",4,"ngFor","ngForOf"],[1,"bg-white","rounded-xl","shadow-sm","border","p-4","flex","flex-col","justify-between"],[1,"text-sm","text-gray-700","mb-3"],[1,"font-semibold"],[1,"flex","justify-end"],["type","button",1,"bg-red-500","hover:bg-red-600","text-white","rounded-full","w-10","h-10","flex","items-center","justify-center","transition",3,"click"],[1,"text-white",2,"font-size","20px"],[1,"text-gray-400"]],template:function(t,i){if(t&1){let s=$();o(0,"div",1)(1,"form",2),u("ngSubmit",function(){return v(s),b(i.onSubmitLand())}),o(2,"h1",3),d(3),a(4,"translate"),a(5,"translate"),n(),o(6,"div",4),g(7,"img",5),o(8,"label",6)(9,"span",7),d(10,"photo_camera"),n(),o(11,"span"),d(12),a(13,"translate"),n(),o(14,"input",8),u("change",function(E){return v(s),b(i.onFileSelected(E))}),n()()(),o(15,"div",9)(16,"div",10)(17,"label",11),d(18),a(19,"translate"),n(),g(20,"input",12),a(21,"translate"),n(),o(22,"div",10)(23,"label",11),d(24),a(25,"translate"),n(),g(26,"input",13),a(27,"translate"),n()(),o(28,"div",9)(29,"div",10)(30,"label",11),d(31),a(32,"translate"),n(),g(33,"input",14),a(34,"translate"),n(),o(35,"div",10)(36,"label",11),d(37),a(38,"translate"),n(),g(39,"input",15),a(40,"translate"),n()(),o(41,"div",16)(42,"button",17),u("click",function(){return v(s),b(i.cancel())}),d(43),a(44,"translate"),n(),o(45,"button",18),d(46),a(47,"translate"),a(48,"translate"),n()(),o(49,"div",19)(50,"div",20)(51,"p",21),d(52),a(53,"translate"),n(),o(54,"button",22),u("click",function(){return v(s),b(i.openAddCoordinateModal())}),d(55),a(56,"translate"),n()(),U(57,we,2,1,"div",23)(58,Fe,3,3,"ng-template",null,0,J),n(),o(60,"div",24)(61,"app-planned-plantations-list",25),u("edit",function(E){return v(s),b(i.onEditPlantation(E))}),n()()()()}if(t&2){let s=Y(59);r(),f("formGroup",i.landForm),r(2),c(" ",i.land!=null&&i.land.id?l(4,20,"LAND_FORM.TITLE_EDIT"):l(5,22,"LAND_FORM.TITLE_NEW")," "),r(4),f("src",i.previewImage||"assets/logo-white.png",X),r(5),_(l(13,24,"LAND_FORM.SELECT_IMAGE")),r(6),_(l(19,26,"LAND_FORM.NAME_LABEL")),r(2),h("placeholder",l(21,28,"LAND_FORM.NAME_PLACEHOLDER")),r(4),_(l(25,30,"LAND_FORM.LOCATION_LABEL")),r(2),h("placeholder",l(27,32,"LAND_FORM.LOCATION_PLACEHOLDER")),r(5),_(l(32,34,"LAND_FORM.AREA_LABEL")),r(2),h("placeholder",l(34,36,"LAND_FORM.AREA_PLACEHOLDER")),r(4),_(l(38,38,"LAND_FORM.MAX_TREES_LABEL")),r(2),h("placeholder",l(40,40,"LAND_FORM.MAX_TREES_PLACEHOLDER")),r(4),c(" ",l(44,42,"LAND_FORM.CANCEL_BUTTON")," "),r(3),c(" ",i.land!=null&&i.land.id?l(47,44,"LAND_FORM.SUBMIT_EDIT"):l(48,46,"LAND_FORM.SUBMIT_NEW")," "),r(6),c(" ",l(53,48,"LANDS.COORDINATES")," "),r(3),c(" ",l(56,50,"LAND_FORM.ADD_COORDINATE")," "),r(2),f("ngIf",i.coordinates==null?null:i.coordinates.length)("ngIfElse",s),r(4),f("plantations",i.plannedPlantations)("editable",!0)}},dependencies:[S,K,Q,Z,de,O,T,R,w,F,le,j,B,P,oe,N,se,pe,ne,ie,M,D,xe],encapsulation:2})}}return p})();export{lt as LandFormComponent};
