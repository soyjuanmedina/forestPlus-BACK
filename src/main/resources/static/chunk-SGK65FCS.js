import{b as de}from"./chunk-RZZXK2GC.js";import{a as ce,b as me,c as ue}from"./chunk-GXPGZDFC.js";import{e as se,g as pe}from"./chunk-F7VVV47E.js";import{a as J}from"./chunk-DQB77XNE.js";import{a as fe}from"./chunk-73X7ILNV.js";import"./chunk-I6AMTEEF.js";import{a as H,b as q}from"./chunk-IF7XPMP2.js";import{a as A,b as F,d as O,e as K,g as Q,h as Z,i as ee,k as te,l as ie,m as ne,n as re,o as oe,r as ae,s as k,t as le}from"./chunk-2SDIOBJD.js";import{a as Y,b as X}from"./chunk-EK56BJYN.js";import{Ab as z,Ba as n,Ca as o,Da as E,Db as $,Fb as w,Ha as C,Ka as m,M as h,Ma as g,Nb as G,Pa as I,Pb as W,S as v,T as y,Xa as l,Xb as N,Ya as b,Yb as P,Za as u,_a as x,a as D,bb as V,cb as B,db as L,ea as i,fa as f,fb as M,hb as j,kb as s,lb as p,ra as _,va as c,yb as U,zb as S}from"./chunk-CQCTACGQ.js";function ve(r,T){if(r&1&&(n(0,"option",12),l(1),o()),r&2){let e=T.$implicit;c("value",e.id),i(),u(" ",e.name," ")}}var ge=(()=>{class r{constructor(e,a,t,d){this.data=e,this.dialogRef=a,this.fb=t,this.treeTypeService=d,this.treeTypes=[],this.form=this.fb.group({treeTypeId:[e.tree.treeTypeId,F.required],scientificName:[e.tree.scientificName],plantedAt:[e.tree.plantedAt,F.required],co2AbsorptionAt20:[{value:e.tree.co2AbsorptionAt20,disabled:!0}]}),this.loadTreeTypes()}loadTreeTypes(){this.treeTypeService.getAllTreeTypes().subscribe(e=>{this.treeTypes=e,this.onTreeTypeChange()})}onTreeTypeChange(){let e=this.form.get("treeTypeId")?.value,a=this.treeTypes.find(t=>t.id===e);a&&this.form.get("co2AbsorptionAt20")?.setValue(a.co2AbsorptionAt20)}save(){if(this.form.invalid)return;let e=D({},this.form.getRawValue());this.dialogRef.close(e)}close(){this.dialogRef.close()}static{this.\u0275fac=function(a){return new(a||r)(f(me),f(ce),f(ae),f(fe))}}static{this.\u0275cmp=h({type:r,selectors:[["app-edit-tree-modal"]],standalone:!0,features:[M],decls:30,vars:27,consts:[[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[3,"ngSubmit","formGroup"],[1,"block","text-gray-700","mb-1"],["formControlName","treeTypeId",1,"w-full","mb-4","border","rounded-xl","p-2",3,"change"],[3,"value",4,"ngFor","ngForOf"],["formControlName","scientificName",1,"w-full","mb-4","border","rounded-xl","p-2",3,"placeholder"],["type","date","formControlName","plantedAt",1,"w-full","mb-4","border","rounded-xl","p-2"],["type","number","formControlName","co2AbsorptionAt20","readonly","",1,"w-full","mb-6","border","rounded-xl","p-2","bg-gray-100"],[1,"flex","justify-end","gap-4"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50","transition",3,"disabled"],[3,"value"]],template:function(a,t){a&1&&(n(0,"div",0)(1,"h2",1),l(2),s(3,"translate"),o(),n(4,"form",2),m("ngSubmit",function(){return t.save()}),n(5,"label",3),l(6),s(7,"translate"),o(),n(8,"select",4),m("change",function(){return t.onTreeTypeChange()}),_(9,ve,2,2,"option",5),o(),n(10,"label",3),l(11),s(12,"translate"),o(),E(13,"input",6),s(14,"translate"),n(15,"label",3),l(16),s(17,"translate"),o(),E(18,"input",7),n(19,"label",3),l(20),s(21,"translate"),o(),E(22,"input",8),n(23,"div",9)(24,"button",10),m("click",function(){return t.close()}),l(25),s(26,"translate"),o(),n(27,"button",11),l(28),s(29,"translate"),o()()()()),a&2&&(i(2),u(" ",p(3,11,"EDIT_TREE.TITLE")," "),i(2),c("formGroup",t.form),i(2),b(p(7,13,"EDIT_TREE.TYPE")),i(3),c("ngForOf",t.treeTypes),i(2),b(p(12,15,"EDIT_TREE.scientificName")),i(2),I("placeholder",p(14,17,"EDIT_TREE.scientificName_PLACEHOLDER")),i(3),b(p(17,19,"EDIT_TREE.PLANTED_AT")),i(4),b(p(21,21,"EDIT_TREE.CO2")),i(5),u(" ",p(26,23,"COMMON.CANCEL")," "),i(2),c("disabled",t.form.invalid),i(),u(" ",p(29,25,"COMMON.SAVE")," "))},dependencies:[w,S,k,Z,re,oe,A,ee,ne,O,K,le,te,ie,P,N,se,pe,de],styles:[".mat-dialog-container[_ngcontent-%COMP%]{max-height:9vh;overflow-y:auto;border-radius:1rem;padding:0;background:transparent}.plant-modal[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .plant-modal[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border-radius:0!important}"]})}}return r})();var ye=r=>({"border-green-600 bg-green-50":r});function Ee(r,T){if(r&1){let e=C();n(0,"button",19),m("click",function(){v(e);let t=g(2).$implicit,d=g();return y(d.goToUser(t.ownerUserId))}),l(1),o()}if(r&2){let e=g(2).$implicit;i(),u(" ",e.ownerUserName," ")}}function Ce(r,T){if(r&1){let e=C();n(0,"button",19),m("click",function(){v(e);let t=g(2).$implicit,d=g();return y(d.goToCompany(t.ownerCompanyId))}),l(1),o()}if(r&2){let e=g(2).$implicit;i(),u(" ",e.ownerCompanyName," ")}}function Ie(r,T){if(r&1&&(n(0,"div",17)(1,"strong"),l(2),s(3,"translate"),o(),_(4,Ee,2,1,"button",18)(5,Ce,2,1,"button",18),o()),r&2){let e=g().$implicit;i(2),u("",p(3,3,"TREE_LIST.OWNER"),":"),i(2),c("ngIf",e.ownerUserId),i(),c("ngIf",e.ownerCompanyId)}}function Me(r,T){if(r&1){let e=C();n(0,"div",8)(1,"div",9)(2,"div",10),l(3),s(4,"translate"),o(),n(5,"div",11),l(6),s(7,"translate"),o(),n(8,"div",12),l(9),s(10,"translate"),s(11,"date"),o(),_(12,Ie,6,5,"div",13),o(),n(13,"div",14)(14,"button",15),m("click",function(){let t=v(e).$implicit,d=g();return y(d.deleteTree(t))}),n(15,"mat-icon",16),l(16,"delete"),o()()()()}if(r&2){let e=T.$implicit;c("ngClass",j(16,ye,e.ownerUserName||e.ownerCompanyName)),i(3),x(" ",p(4,8,"TREE_LIST.ID"),": ",e.id," "),i(3),x(" ",p(7,10,"TREE_LIST.TYPE"),": ",e.treeTypeName," "),i(3),x(" ",p(10,12,"TREE_LIST.PLANTED_AT"),": ",p(11,14,e.plantedAt)," "),i(3),c("ngIf",e.ownerUserName||e.ownerCompanyName)}}var qe=(()=>{class r{constructor(e,a,t,d){this.treeService=e,this.dialog=a,this.router=t,this.route=d,this.trees=[],this.filteredTrees=[],this.filterText="",this.currentPage=0,this.pageSize=10,this.totalPages=1}ngOnInit(){this.loadTrees()}loadTrees(){let e=Number(this.route.snapshot.paramMap.get("landId")),a=Number(this.route.snapshot.paramMap.get("treeTypeId"));this.treeService.getTreesByLandAndType(e,a).subscribe(t=>{this.trees=t,this.applyFilter()})}applyFilter(){let e=this.filterText.toLowerCase();this.filteredTrees=this.trees.filter(a=>(a.treeTypeName||"").toLowerCase().includes(e)||(a.id+"").includes(e)),this.currentPage=0,this.totalPages=Math.ceil(this.filteredTrees.length/this.pageSize)}getPagedTrees(){let e=this.currentPage*this.pageSize;return this.filteredTrees.slice(e,e+this.pageSize)}previousPage(){this.currentPage>0&&this.currentPage--}nextPage(){this.currentPage+1<this.totalPages&&this.currentPage++}openEditModal(e){this.dialog.open(ge,{width:"400px",data:{tree:e||null}}).afterClosed().subscribe(t=>{t&&this.loadTrees()})}deleteTree(e){if(!e.id){console.error("El \xE1rbol no tiene ID, no se puede eliminar");return}this.treeService.deleteTree(e.id).subscribe(()=>this.loadTrees())}goToUser(e){this.router.navigate(["/profile/",e])}goToCompany(e){this.router.navigate(["/company/",e])}static{this.\u0275fac=function(a){return new(a||r)(f(J),f(ue),f(W),f(G))}}static{this.\u0275cmp=h({type:r,selectors:[["app-edit-trees"]],standalone:!0,features:[M],decls:19,vars:15,consts:[[1,"p-4"],[1,"flex","justify-between","items-center","mb-4"],["type","text",1,"w-64","rounded-xl","border","border-gray-300","px-4","py-2","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent","transition",3,"ngModelChange","keyup","placeholder","ngModel"],[1,"flex","flex-col","gap-4"],["class","border rounded p-4 shadow-sm flex justify-between items-center w-full transition",3,"ngClass",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-center","items-center","gap-4"],[1,"flex","items-center","justify-center","gap-2","bg-green-600","text-white","py-2","px-4","rounded-xl","hover:bg-green-700","disabled:opacity-50","transition",3,"click","disabled"],[1,"text-gray-700","font-medium"],[1,"border","rounded","p-4","shadow-sm","flex","justify-between","items-center","w-full","transition",3,"ngClass"],[1,"flex","flex-col","text-left"],[1,"font-semibold","text-lg"],[1,"text-gray-600"],[1,"text-gray-500","text-sm"],["class","mt-2 p-2 bg-green-100 border border-green-500 rounded-lg text-green-800 text-sm flex items-center gap-1",4,"ngIf"],[1,"flex","gap-2"],[1,"bg-red-500","hover:bg-red-600","text-white","rounded-full","p-2","flex","items-center","justify-center",3,"click"],[1,"text-white",2,"font-size","20px"],[1,"mt-2","p-2","bg-green-100","border","border-green-500","rounded-lg","text-green-800","text-sm","flex","items-center","gap-1"],["class","text-green-700 underline hover:text-green-900",3,"click",4,"ngIf"],[1,"text-green-700","underline","hover:text-green-900",3,"click"]],template:function(a,t){a&1&&(n(0,"mat-card",0)(1,"div",1)(2,"input",2),s(3,"translate"),L("ngModelChange",function(R){return B(t.filterText,R)||(t.filterText=R),R}),m("keyup",function(){return t.applyFilter()}),o()(),n(4,"div",3),_(5,Me,17,18,"div",4),o(),n(6,"div",5)(7,"button",6),m("click",function(){return t.previousPage()}),n(8,"mat-icon"),l(9,"chevron_left"),o(),l(10),s(11,"translate"),o(),n(12,"span",7),l(13),o(),n(14,"button",6),m("click",function(){return t.nextPage()}),l(15),s(16,"translate"),n(17,"mat-icon"),l(18,"chevron_right"),o()()()()),a&2&&(i(2),I("placeholder",p(3,9,"TREE_LIST.SEARCH_PLACEHOLDER")),V("ngModel",t.filterText),i(3),c("ngForOf",t.getPagedTrees()),i(2),c("disabled",t.currentPage===0),i(3),u(" ",p(11,11,"COMMON.PREVIOUS")," "),i(3),x(" ",t.currentPage+1," / ",t.totalPages," "),i(),c("disabled",t.currentPage+1>=t.totalPages),i(),u(" ",p(16,13,"COMMON.NEXT")," "))},dependencies:[w,U,S,z,$,k,A,O,Q,X,Y,q,H,P,N],styles:[`@charset "UTF-8";.tree-action-button{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background-color:#e0e0ff;color:#00006e;transition:background-color .2s}.tree-action-button:hover{background-color:#1cc07d}.tree-action-button mat-icon{font-size:24px}.tree-action-button.delete{background-color:#f87171}.tree-action-button.delete:hover{background-color:#ef4444}
`],encapsulation:2})}}return r})();export{qe as EditTreesComponent};
