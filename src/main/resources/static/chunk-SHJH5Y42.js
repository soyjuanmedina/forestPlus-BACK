import{b as q,c as U}from"./chunk-HULGEKQ2.js";import{a as me}from"./chunk-XS7UVQ2S.js";import{a as O,b as P,h as se}from"./chunk-V3ZUTP7L.js";import{a as ce}from"./chunk-KJOA3MG3.js";import{a as X}from"./chunk-2NTTT4Z7.js";import{a as de}from"./chunk-MFMAHMNS.js";import{a as Y,b as z}from"./chunk-ZHCHUJD6.js";import{b as Q}from"./chunk-HFKDLU6P.js";import{b as H,d as x,f as J,g as K,j as W,k as Z,l as ee,m as te,n as ie,o as ne,p as re,q as ae,s as oe,t as le,u as pe}from"./chunk-KRWOFNNG.js";import{$a as M,Ba as R,Ea as T,Ga as v,Ib as $,J as b,Ja as F,O as h,P as I,Qa as L,Qb as A,Ra as l,Rb as w,Sa as y,Ta as f,Va as V,a as B,aa as n,ba as u,eb as s,fb as d,gb as j,hb as D,la as _,pa as p,sb as E,tb as C,va as r,vb as G,wa as o,wb as k,xa as S,yb as N}from"./chunk-46BDENMO.js";function Te(t,c){if(t&1&&(r(0,"option",11),l(1),o()),t&2){let e=c.$implicit;p("value",e.id),n(),y(e.name)}}function ye(t,c){if(t&1&&(r(0,"option",11),l(1),s(2,"date"),s(3,"translate"),o()),t&2){let e=c.$implicit;p("value",e.id),n(),V(" ",j(2,4,e.plannedDate,"dd/MM/yyyy")," \xB7 ",e.maxTrees," ",d(3,7,"PLANNED_PLANTATION.MAX_TREES")," ")}}function xe(t,c){if(t&1&&(r(0,"div",3)(1,"label",4),l(2),s(3,"translate"),o(),r(4,"select",12)(5,"option",13),l(6),s(7,"translate"),o(),_(8,ye,4,9,"option",6),o()()),t&2){let e=v();n(2),f(" ",d(3,4,"ASSIGN_TREES.PLANNED_PLANTATION")," "),n(3),p("ngValue",null),n(),f(" ",d(7,6,"COMMON.SELECT_OPTION")," "),n(2),p("ngForOf",e.plannedPlantations)}}function he(t,c){if(t&1&&(r(0,"option",11),l(1),o()),t&2){let e=c.$implicit;p("value",e.id),n(),y(e.name)}}function Ie(t,c){if(t&1&&(r(0,"div",3)(1,"label",4),l(2),s(3,"translate"),o(),r(4,"select",14)(5,"option",13),l(6),s(7,"translate"),o(),_(8,he,2,2,"option",6),o()()),t&2){let e=v();n(2),y(d(3,4,"PLANT_TREES.TREE_TYPE")),n(3),p("ngValue",null),n(),y(d(7,6,"COMMON.SELECT_OPTION")),n(2),p("ngForOf",e.treeTypes)}}function Se(t,c){t&1&&(r(0,"div",3)(1,"label",4),l(2),s(3,"translate"),o(),S(4,"input",15),s(5,"translate"),o()),t&2&&(n(2),f(" ",d(3,2,"ASSIGN_TREES.QUANTITY")," "),n(2),F("placeholder",d(5,4,"ASSIGN_TREES.QUANTITY")))}var je=(()=>{class t{constructor(e,a,i,m,g,ue){this.fb=e,this.landService=a,this.treeTypeService=i,this.plannedPlantationService=m,this.dialogRef=g,this.data=ue,this.lands=[],this.plannedPlantations=[],this.treeTypes=[],this.form=this.fb.group({landId:[null,x.required],plannedPlantationId:[null,x.required],treeTypeId:[null,x.required],quantity:[null,[x.required,x.min(1)]]})}ngOnInit(){this.landService.getAllLands().subscribe(e=>this.lands=e),this.treeTypeService.getAllTreeTypes().subscribe(e=>this.treeTypes=e)}onLandChange(e){let a=Number(e.target.value);this.form.patchValue({plannedPlantationId:null,quantity:null}),this.plannedPlantations=[],this.plannedPlantationService.getByLand(a).subscribe(i=>this.plannedPlantations=i)}submit(){if(!this.form.valid)return;let{landId:e,plannedPlantationId:a,treeTypeId:i,quantity:m}=this.form.value,g=B({ownerUserId:this.data.userId,ownerCompanyId:this.data.companyId},this.form.value);console.log("payload",g),this.dialogRef.close(g)}static{this.\u0275fac=function(a){return new(a||t)(u(oe),u(me),u(de),u(ce),u(O),u(P))}}static{this.\u0275cmp=b({type:t,selectors:[["app-assign-trees-modal"]],standalone:!0,features:[M],decls:21,vars:18,consts:[[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[3,"ngSubmit","formGroup"],[1,"mb-6"],[1,"block","text-gray-700","mb-1"],["formControlName","landId",1,"w-full","rounded-xl","border","border-gray-300","p-2",3,"change"],[3,"value",4,"ngFor","ngForOf"],["class","mb-6",4,"ngIf"],[1,"flex","justify-end","gap-4","mt-8"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50","transition",3,"disabled"],[3,"value"],["formControlName","plannedPlantationId",1,"w-full","rounded-xl","border","border-gray-300","p-2"],["disabled","",3,"ngValue"],["formControlName","treeTypeId",1,"w-full","rounded-xl","border","border-gray-300","p-2"],["type","number","formControlName","quantity","min","1",1,"w-full","px-0","py-2","border-b","border-gray-300","focus:border-green-500","bg-transparent","outline-none",3,"placeholder"]],template:function(a,i){if(a&1&&(r(0,"div",0)(1,"h2",1),l(2),s(3,"translate"),o(),r(4,"form",2),T("ngSubmit",function(){return i.submit()}),r(5,"div",3)(6,"label",4),l(7),s(8,"translate"),o(),r(9,"select",5),T("change",function(g){return i.onLandChange(g)}),_(10,Te,2,2,"option",6),o()(),_(11,xe,9,8,"div",7)(12,Ie,9,8,"div",7)(13,Se,6,6,"div",7),r(14,"div",8)(15,"button",9),T("click",function(){return i.dialogRef.close()}),l(16),s(17,"translate"),o(),r(18,"button",10),l(19),s(20,"translate"),o()()()()),a&2){let m,g;n(2),f(" ",d(3,10,"ASSIGN_TREES.TITLE")," "),n(2),p("formGroup",i.form),n(3),y(d(8,12,"ASSIGN_TREES.LAND")),n(3),p("ngForOf",i.lands),n(),p("ngIf",i.plannedPlantations==null?null:i.plannedPlantations.length),n(),p("ngIf",((m=i.form.get("plannedPlantationId"))==null?null:m.value)&&(i.treeTypes==null?null:i.treeTypes.length)),n(),p("ngIf",(g=i.form.get("plannedPlantationId"))==null?null:g.value),n(3),f(" ",d(17,14,"COMMON.CANCEL")," "),n(2),p("disabled",i.form.invalid),n(),f(" ",d(20,16,"ASSIGN_TREES.ASSIGN")," ")}},dependencies:[N,E,C,k,se,Q,le,W,ne,re,H,Z,ie,J,K,ae,pe,ee,te,w,A],encapsulation:2})}}return t})();function be(t,c){t&1&&S(0,"app-loading-spinner")}function Me(t,c){if(t&1){let e=R();r(0,"li",9)(1,"div")(2,"span",10),l(3),o(),S(4,"br"),r(5,"span",11),l(6),o()(),r(7,"div",12)(8,"button",13),T("click",function(){let i=h(e).$implicit,m=v(3);return I(m.viewTree(i.id))}),r(9,"mat-icon",14),l(10,"visibility"),o()(),r(11,"button",13),T("click",function(){let i=h(e).$implicit,m=v(3);return I(m.editTree(i.id))}),r(12,"mat-icon",15),l(13,"edit"),o()(),r(14,"button",16),T("click",function(){let i=h(e).$implicit,m=v(3);return I(m.unassignTree(i.id))}),r(15,"mat-icon",15),l(16,"delete"),o()()()()}if(t&2){let e=c.$implicit;n(3),f("Terreno: ",e.landName,""),n(3),y(e.treeTypeName)}}function Ee(t,c){if(t&1&&(r(0,"ul"),_(1,Me,17,2,"li",8),o()),t&2){let e=v(2);n(),p("ngForOf",e.trees)}}function Ce(t,c){t&1&&(r(0,"p",17),l(1),s(2,"translate"),o()),t&2&&(n(),y(d(2,1,"ASSIGN_TREES.NO_TREES_TO_MANAGE")))}function Ne(t,c){if(t&1){let e=R();r(0,"div",3)(1,"h2",4),l(2),s(3,"translate"),o(),_(4,Ee,2,1,"ul",5)(5,Ce,3,3,"ng-template",null,0,D),r(7,"div",6)(8,"button",7),T("click",function(){h(e);let i=v();return I(i.close())}),l(9),s(10,"translate"),o()()()}if(t&2){let e=L(6),a=v();n(2),f(" ",d(3,4,"MANAGE_TREES.TITLE")," "),n(2),p("ngIf",a.trees==null?null:a.trees.length)("ngIfElse",e),n(5),f(" ",d(10,6,"COMMON.CLOSE")," ")}}var Je=(()=>{class t{constructor(e,a,i,m,g){this.data=e,this.dialogRef=a,this.treeService=i,this.router=m,this.loadingService=g,this.treeTypeName="",this.trees=[],this.target="company",this.treeTypeName=e.treeTypeName||"",this.target=e.target||"company",this.companyId=e.companyId,this.treeTypeId=e.treeTypeId}ngOnInit(){if(this.loadingService.show(),this.data.userId&&this.treeTypeId!==void 0){this.target="user",this.treeService.getTreesByOwnerAndType(this.treeTypeId,this.data.userId,void 0).subscribe({next:e=>this.trees=e,error:e=>console.error("Error cargando \xE1rboles del usuario",e),complete:()=>this.loadingService.hide()});return}if(this.data.companyId&&this.treeTypeId!==void 0){this.target="company",this.treeService.getTreesByOwnerAndType(this.treeTypeId,void 0,this.data.companyId).subscribe({next:e=>this.trees=e,error:e=>console.error("Error cargando \xE1rboles de la compa\xF1\xEDa",e),complete:()=>this.loadingService.hide()});return}this.loadingService.hide(),console.error("\u274C No se proporcion\xF3 ni userId ni companyId al modal")}unassignTree(e){let a;this.target==="company"?a=this.treeService.unassignTreeFromCompany(e):a=this.treeService.unassignTreeFromUser(e),a.subscribe({next:()=>{this.trees=this.trees.filter(i=>i.id!==e)},error:i=>console.error("\u274C Error al desasignar \xE1rbol",i)})}viewTree(e){this.router.navigate(["/tree",e]),this.dialogRef.close({updated:!0})}editTree(e){this.router.navigate(["/tree/form",e]),this.dialogRef.close({updated:!0})}close(){this.dialogRef.close({updated:!0})}static{this.\u0275fac=function(a){return new(a||t)(u(P),u(O),u(X),u($),u(q))}}static{this.\u0275cmp=b({type:t,selectors:[["app-manage-trees-modal"]],standalone:!0,features:[M],decls:4,vars:6,consts:[["noTrees",""],[4,"ngIf"],["class","p-6 w-full max-w-md bg-white rounded-2xl shadow-lg",4,"ngIf"],[1,"p-6","w-full","max-w-md","bg-white","rounded-2xl","shadow-lg"],[1,"text-2xl","font-bold","text-green-700","mb-6","text-center"],[4,"ngIf","ngIfElse"],[1,"flex","justify-end","mt-6"],["type","button",1,"px-4","py-2","rounded-lg","bg-gray-200","text-gray-700","hover:bg-gray-300","transition",3,"click"],["class","flex justify-between items-center border-b py-2",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","border-b","py-2"],[1,"text-sm","text-gray-500"],[1,"font-semibold"],[1,"flex","gap-2"],[1,"bg-green-600","hover:bg-green-700","text-white","rounded-full","p-2","flex","items-center","justify-center",3,"click"],[1,"text-white",2,"font-size","20px"],[2,"font-size","20px"],[1,"bg-red-600","hover:bg-red-700","text-white","rounded-full","p-2","flex","items-center","justify-center",3,"click"],[1,"text-gray-500","italic"]],template:function(a,i){a&1&&(_(0,be,1,0,"app-loading-spinner",1),s(1,"async"),_(2,Ne,11,8,"div",2),s(3,"async")),a&2&&(p("ngIf",d(1,2,i.loadingService.loading$)),n(2),p("ngIf",!d(3,4,i.loadingService.loading$)))},dependencies:[N,E,C,G,w,A,z,Y,U],encapsulation:2})}}return t})();export{je as a,Je as b};
